{% extends 'base.html' %}
{% block title%}Recipe{% endblock %}
{% block content %}

<div class="container-fluid">
    <div class="row">
        <div class="col-xs-12 col-md-5">
            <img src="{{ recipe.img_url }}" alt="{{ recipe.recipe_name }}" class="img-responsive img-rounded">
        </div>
        <div class="col-xs-12 col-md-7">
            <h1 id="recname">{{ recipe.recipe_name }}</h1>
            {% if session.get("user_id") %}
                <h4>
                    <form action="/save_recipe/{{ recipe.recipe_id }}">
                        <input type="submit" value="Save Recipe">
                    </form>
                </h4>
            {% endif %}
            Source: <a href="{{ recipe.src_url }}">{{ recipe.websites.site_name }}</a><br>
            Total Time: {{ recipe.time_in_min}} minutes<br>
            Course(s): 
            {% for course in recipe.courses[:-1] %}
                {{ course.course_name }},
            {% endfor %}
            {{ recipe.courses[-1].course_name }}<br>
            Serving Size:
            <select id="serving">
                <option id="serving-opt{{ recipe.servings[0].serving_size }}" selected>
                    {{ recipe.servings[0].serving_size }}
                </option>
                {% for number in serving_range %}
                    {% if number != recipe.servings[0].serving_size %}
                        <option id="serving-opt{{ number }}">{{ number }}</option>
                    {% endif %}
                {% endfor %}
            </select>
            <button id="convert">Convert</button>
            <br><br><br>
            Ingredients:<br>
            <table class="table" id="ingredients">
                {% for ingredient in recipe.recipesingredients %}
                <tr>
                    <td>
                        {% if ingredient.usamounts %}
                            {% for amount in ingredient.usamounts[:-1] %}
                                {{ amount.us_amount }}-
                            {% endfor %}
                            {{ ingredient.usamounts[-1].us_amount}}
                        {% endif %}
                        {% if ingredient.usmeasurements %}
                            {{ ingredient.usmeasurements[0].us_unit }}
                        {% endif %}                            
                    </td>                    
                    <td>
                        {% if ingredient.metricamounts %}
                            ({% for amount in ingredient.metricamounts[:-1] %}
                                {{ amount.metric_amount }}-
                            {% endfor %}
                            {{ ingredient.metricamounts[-1].metric_amount }}
                            {{ ingredient.metricmeasurements[0].metric_unit }})
                        {% endif %}

                    </td>
                    <td>
                        {% if ingredient.link %}
                            <a href="{{ ingredient.link }}">{{ ingredient.original_string }}</a>
                        {% else %}
                            {{ ingredient.original_string }}
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>
    <br><br>
    <div class="row">
        <div class="col-xs-12 col-md-8 col-md-offset-2">
            Instructions:<br><br>
            <table class="table" id="instructions">
                {% for instruction in recipe.instructions %}
                    <tr>
                        <td>{{ instruction.step_order}}</td>
                        <td>{{ instruction.step_instruction}}</td>
                    </tr>
                {% endfor %}
            </table>
        </div>
    </div>
    <br><br><br><br>
    <div class="row">
        <div class="col-xs-6 col-xs-push-3 col-md-4 col-md-push-4">
            <center><a href="/"><img src="/static/img/Vegan_clipart.png" alt="Home" class="img-responsive img-circle" width="200"></a></center>
        </div>
    </div>
</div>
<script>
    function replaceNumbers(result) {
        Something
    }

    function convert(evt) {

        var info = {
            "serving": $('#serving').val(),
            "recipe_name": $('#recname').html()
        };
        // var serving = $('#serving').val();
        // var recipe_name = $('#recname').html();
        
        console.log(info.serving)
        console.log(info.recipe_name)
        $.get('/convert.json', info, replaceNumbers);

    }

    $('#convert').on('click', convert);
</script>

{% endblock %}